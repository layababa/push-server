<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æœåŠ¡å¤§å…</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* === åˆ—è¡¨é¡µ === */
        .page { display: block; }
        .page.hidden { display: none; }

        .list-page { padding: 16px; padding-bottom: 32px; }
        .header { text-align: center; padding: 20px 0 16px; }
        .header h1 { font-size: 20px; font-weight: 600; color: #1a1a1a; }
        .header p { font-size: 13px; color: #999; margin-top: 4px; }

        .service-list { display: flex; flex-direction: column; gap: 12px; }
        .service-card {
            background: #fff; border-radius: 12px; padding: 16px;
            display: flex; align-items: center; gap: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06); cursor: pointer;
            transition: transform 0.15s;
        }
        .service-card:active { transform: scale(0.98); }
        .service-icon {
            width: 48px; height: 48px; border-radius: 10px;
            object-fit: cover; background: #f0f0f0; flex-shrink: 0;
        }
        .service-info { flex: 1; min-width: 0; }
        .service-name { font-size: 15px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px; }
        .service-desc {
            font-size: 12px; color: #999; line-height: 1.4;
            overflow: hidden; text-overflow: ellipsis;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
        }
        .arrow { color: #ccc; font-size: 18px; flex-shrink: 0; }

        /* === è¯¦æƒ…é¡µ === */
        .detail-page {
            background: #fff; min-height: 100vh;
        }
        .detail-nav {
            position: sticky; top: 0; background: #fff; z-index: 10;
            display: flex; align-items: center; padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
        }
        .detail-back {
            font-size: 22px; color: #333; cursor: pointer; padding: 4px 8px 4px 0;
            background: none; border: none; line-height: 1;
        }
        .detail-nav-title { font-size: 16px; font-weight: 600; flex: 1; }

        .detail-hero {
            text-align: center; padding: 32px 24px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        .detail-hero-icon {
            width: 72px; height: 72px; border-radius: 16px;
            object-fit: cover; background: rgba(255,255,255,0.2);
            border: 3px solid rgba(255,255,255,0.4);
            margin: 0 auto 16px;
        }
        .detail-hero h2 { font-size: 22px; font-weight: 700; margin-bottom: 6px; }
        .detail-hero .service-code { font-size: 12px; opacity: 0.7; }

        .detail-body { padding: 0 16px 32px; }

        .detail-section {
            padding: 20px 0; border-bottom: 1px solid #f5f5f5;
        }
        .detail-section:last-child { border-bottom: none; }
        .detail-section-title {
            font-size: 14px; font-weight: 600; color: #1a1a1a; margin-bottom: 12px;
            display: flex; align-items: center; gap: 6px;
        }
        .detail-section-title .icon { font-size: 16px; }
        .detail-section p {
            font-size: 13px; color: #666; line-height: 1.8;
        }

        .spec-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .spec-item {
            background: #f9f9f9; border-radius: 8px; padding: 12px;
        }
        .spec-label { font-size: 11px; color: #999; margin-bottom: 4px; }
        .spec-value { font-size: 14px; font-weight: 600; color: #333; }

        .feature-list { list-style: none; }
        .feature-list li {
            font-size: 13px; color: #666; line-height: 1.6;
            padding: 6px 0; padding-left: 20px; position: relative;
        }
        .feature-list li::before {
            content: 'âœ“'; position: absolute; left: 0;
            color: #4F46E5; font-weight: 700;
        }

        .detail-btn-area {
            padding: 16px; position: sticky; bottom: 0;
            background: #fff; border-top: 1px solid #f0f0f0;
        }
        .btn-full {
            width: 100%; padding: 14px; border-radius: 12px;
            font-size: 16px; font-weight: 600; border: none; cursor: pointer;
            transition: all 0.2s;
        }
        .btn-full-primary { background: #4F46E5; color: #fff; }
        .btn-full-primary:active { background: #4338CA; }
        .btn-full-secondary { background: #f5f5f5; color: #999; }
        .btn-full-danger {
            background: #fff; color: #e53e3e;
            border: 1.5px solid #e53e3e;
        }
        .btn-full-danger:active { background: #fef2f2; }
        .btn-full:disabled { opacity: 0.6; cursor: not-allowed; }

        .loading { text-align: center; padding: 60px 0; color: #999; font-size: 14px; }
        .error { text-align: center; padding: 60px 0; color: #e53e3e; font-size: 14px; }
        .error button {
            margin-top: 12px; padding: 8px 24px; background: #4F46E5;
            color: #fff; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;
        }
        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.75); color: #fff; padding: 10px 24px;
            border-radius: 20px; font-size: 13px; z-index: 100;
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        .toast.show { opacity: 1; }
    </style>
</head>
<body>
    <!-- åˆ—è¡¨é¡µ -->
    <div id="listPage" class="page list-page">
        <div class="header">
            <h1>æœåŠ¡å¤§å…</h1>
            <p>å‘ç°å¹¶è®¢é˜…æ„Ÿå…´è¶£çš„æ¨é€æœåŠ¡</p>
        </div>
        <div id="content">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <!-- è¯¦æƒ…é¡µ -->
    <div id="detailPage" class="page hidden detail-page">
        <div class="detail-nav">
            <button class="detail-back" onclick="showList()">â€¹</button>
            <div class="detail-nav-title">æœåŠ¡è¯¦æƒ…</div>
        </div>
        <div id="detailContent"></div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const token = params.get('token');
        const BASE_URL = window.location.origin;

        // æ¯ä¸ªæœåŠ¡çš„ä¸“ä¸šè¯¦ç»†ä¿¡æ¯
        const SERVICE_DETAILS = {
            'srv_aliyun_status': {
                gradient: 'linear-gradient(135deg, #FF6B35 0%, #F7C948 100%)',
                overview: 'å®æ—¶ç›‘æ§é˜¿é‡Œäº‘å…¨çƒå„å¯ç”¨åŒºï¼ˆååŒ—ã€åä¸œã€åå—ã€è¥¿å—ã€é¦™æ¸¯ã€æ–°åŠ å¡ç­‰ï¼‰çš„æœåŠ¡å¥åº·çŠ¶æ€ã€‚å½“æ£€æµ‹åˆ°è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œã€æ•°æ®åº“ç­‰æ ¸å¿ƒæœåŠ¡å‡ºç°å¼‚å¸¸æˆ–æ€§èƒ½é™çº§æ—¶ï¼Œç¬¬ä¸€æ—¶é—´æ¨é€å‘Šè­¦é€šçŸ¥åˆ°æ‚¨çš„è®¾å¤‡ã€‚',
                specs: [
                    { label: 'ç›‘æ§èŒƒå›´', value: 'å…¨çƒ 28 ä¸ªå¯ç”¨åŒº' },
                    { label: 'æ£€æµ‹é¢‘ç‡', value: 'æ¯ 30 ç§’' },
                    { label: 'å¹³å‡å»¶è¿Ÿ', value: '< 15 ç§’' },
                    { label: 'æ•°æ®æ¥æº', value: 'é˜¿é‡Œäº‘å®˜æ–¹ API' }
                ],
                features: [
                    'ECSã€RDSã€OSSã€SLB ç­‰ 40+ äº§å“çº¿è¦†ç›–',
                    'åŒºåˆ†ã€ŒæœåŠ¡å¼‚å¸¸ã€ä¸ã€Œæ€§èƒ½é™çº§ã€ä¸¤çº§å‘Šè­¦',
                    'æ”¯æŒæŒ‰å¯ç”¨åŒºå’Œäº§å“çº¿ç²¾å‡†æ¨é€',
                    'åŒ…å«æ•…éšœæ¢å¤é€šçŸ¥ï¼Œé—­ç¯è·Ÿè¸ª',
                    'å†å²äº‹ä»¶å›æº¯ï¼Œè¾…åŠ© SLA ç»Ÿè®¡'
                ],
                scenarios: 'é€‚ç”¨äºå°†ä¸šåŠ¡éƒ¨ç½²åœ¨é˜¿é‡Œäº‘ä¸Šçš„è¿ç»´å·¥ç¨‹å¸ˆã€SRE å›¢é˜Ÿå’ŒæŠ€æœ¯è´Ÿè´£äººã€‚å½“é˜¿é‡Œäº‘åŸºç¡€è®¾æ–½å‡ºç°é—®é¢˜æ—¶ï¼Œå¸®åŠ©æ‚¨åœ¨ç”¨æˆ·æŠ•è¯‰ä¹‹å‰è·çŸ¥æ•…éšœï¼Œå¿«é€Ÿå¯åŠ¨åº”æ€¥é¢„æ¡ˆã€‚'
            },
            'srv_weather_alerts': {
                gradient: 'linear-gradient(135deg, #4FACFE 0%, #00F2FE 100%)',
                overview: 'å¯¹æ¥ä¸­å›½æ°”è±¡å±€åŠå„çœçº§æ°”è±¡å°çš„å®˜æ–¹é¢„è­¦ä¿¡å·æ•°æ®æºï¼Œè¦†ç›–æš´é›¨ã€æš´é›ªã€å°é£ã€é«˜æ¸©ã€å¯’æ½®ã€å¤§é›¾ã€é›·ç”µç­‰ 14 ç±»æ°”è±¡ç¾å®³é¢„è­¦ã€‚å½“æ‚¨æ‰€åœ¨åŸå¸‚å‘å¸ƒæ©™è‰²æˆ–çº¢è‰²é¢„è­¦ä¿¡å·æ—¶ï¼Œå³æ—¶æ¨é€è‡³æ‚¨çš„è®¾å¤‡ã€‚',
                specs: [
                    { label: 'è¦†ç›–åŸå¸‚', value: 'å…¨å›½ 340+ åœ°çº§å¸‚' },
                    { label: 'é¢„è­¦ç±»å‹', value: '14 ç±»æ°”è±¡ç¾å®³' },
                    { label: 'æ•°æ®æ¥æº', value: 'ä¸­å›½æ°”è±¡å±€' },
                    { label: 'æ¨é€å»¶è¿Ÿ', value: '< 60 ç§’' }
                ],
                features: [
                    'æš´é›¨ã€å°é£ã€é«˜æ¸©ã€å¯’æ½®ç­‰å…¨ç±»å‹è¦†ç›–',
                    'ä»…æ¨é€æ©™è‰²åŠä»¥ä¸Šé«˜çº§åˆ«é¢„è­¦ï¼Œé¿å…æ‰“æ‰°',
                    'é¢„è­¦å†…å®¹å«é˜²å¾¡æŒ‡å—å’Œåº”æ€¥å»ºè®®',
                    'é¢„è­¦è§£é™¤æ—¶åŒæ­¥æ¨é€è§£é™¤é€šçŸ¥',
                    'æ”¯æŒåŸºäº GPS è‡ªåŠ¨å®šä½æ‰€åœ¨åŸå¸‚'
                ],
                scenarios: 'é€‚ç”¨äºå…³æ³¨æç«¯å¤©æ°”å½±å“å‡ºè¡Œå®‰æ’çš„æ™®é€šç”¨æˆ·ï¼Œä»¥åŠéœ€è¦æå‰éƒ¨ç½²é˜²ç¾æªæ–½çš„ç‰©æµã€å†œä¸šã€å»ºç­‘ç­‰è¡Œä¸šä»ä¸šè€…ã€‚'
            },
            'srv_football_goals': {
                gradient: 'linear-gradient(135deg, #43E97B 0%, #38F9D7 100%)',
                overview: 'è¦†ç›–è‹±è¶…ã€è¥¿ç”²ã€å¾·ç”²ã€æ„ç”²ã€æ³•ç”²äº”å¤§è”èµ›ä»¥åŠæ¬§å† ã€æ¬§è”æ¯ç­‰é¡¶çº§èµ›äº‹ã€‚é€šè¿‡å¯¹æ¥æƒå¨ä½“è‚²æ•°æ®æœåŠ¡å•†çš„å®æ—¶æ¯”èµ›äº‹ä»¶æµï¼Œåœ¨è¿›çƒå‘ç”Ÿåæ•°ç§’å†…å°†è¿›çƒçƒå‘˜ã€æ¯”åˆ†å˜åŒ–å’Œæ¯”èµ›ä¿¡æ¯æ¨é€è‡³æ‚¨çš„è®¾å¤‡ã€‚',
                specs: [
                    { label: 'è¦†ç›–èµ›äº‹', value: 'äº”å¤§è”èµ› + æ¬§æˆ˜' },
                    { label: 'èµ›å­£åœºæ¬¡', value: '2000+ åœº/èµ›å­£' },
                    { label: 'æ•°æ®æ¥æº', value: 'Opta Sports' },
                    { label: 'æ¨é€å»¶è¿Ÿ', value: '< 10 ç§’' }
                ],
                features: [
                    'è‹±è¶…ã€è¥¿ç”²ã€å¾·ç”²ã€æ„ç”²ã€æ³•ç”²å…¨è¦†ç›–',
                    'æ¬§å† ã€æ¬§è”æ¯æ·˜æ±°èµ›é˜¶æ®µè‡ªåŠ¨çº³å…¥',
                    'æ¨é€å†…å®¹å«è¿›çƒçƒå‘˜ã€åŠ©æ”»çƒå‘˜ã€å®æ—¶æ¯”åˆ†',
                    'æ”¯æŒçº¢ç‰Œã€ç‚¹çƒã€VAR æ”¹åˆ¤ç­‰å…³é”®äº‹ä»¶',
                    'èµ›å‰ 15 åˆ†é’Ÿæ¨é€é¦–å‘é˜µå®¹æé†’'
                ],
                scenarios: 'é€‚ç”¨äºæ— æ³•å®ˆåœ¨å±å¹•å‰çœ‹çƒä½†åˆä¸æƒ³é”™è¿‡ç²¾å½©è¿›çƒçš„çƒè¿·ã€‚æ— è®ºæ˜¯åœ¨é€šå‹¤ã€å¼€ä¼šè¿˜æ˜¯å¥èº«ï¼Œè¿›çƒç¬é—´å³åˆ»è·çŸ¥ã€‚'
            }
        };

        // é»˜è®¤è¯¦æƒ…ï¼ˆå…œåº•ï¼‰
        const DEFAULT_DETAIL = {
            gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            overview: 'æ­¤æœåŠ¡ç”±å¹³å°å®˜æ–¹è¿è¥å›¢é˜Ÿç»´æŠ¤ï¼Œé€šè¿‡å®šæ—¶æŠ“å–å¤–éƒ¨æƒå¨æ•°æ®æºï¼Œåœ¨è§¦å‘é¢„è®¾æ¡ä»¶æ—¶å‘æ‰€æœ‰è®¢é˜…ç”¨æˆ·æ‰¹é‡æ¨é€é€šçŸ¥ã€‚',
            specs: [
                { label: 'è¿è¥æ–¹', value: 'å¹³å°å®˜æ–¹' },
                { label: 'æ¨é€é¢‘ç‡', value: 'äº‹ä»¶è§¦å‘' },
                { label: 'æ•°æ®æ¥æº', value: 'å®˜æ–¹ API' },
                { label: 'æ¨é€å»¶è¿Ÿ', value: '< 60 ç§’' }
            ],
            features: [
                'ç”±å¹³å°å®˜æ–¹å›¢é˜Ÿä¸“ä¸šè¿è¥ç»´æŠ¤',
                '7Ã—24 å°æ—¶ä¸é—´æ–­ç›‘æ§',
                'æ™ºèƒ½å»é‡ï¼Œé¿å…é‡å¤æ¨é€',
                'æ”¯æŒè®¢é˜…åå³æ—¶ç”Ÿæ•ˆï¼Œé€€è®¢åç«‹å³åœæ­¢'
            ],
            scenarios: 'é€‚ç”¨äºå¸Œæœ›ç¬¬ä¸€æ—¶é—´è·å–å…³é”®äº‹ä»¶é€šçŸ¥çš„ç”¨æˆ·ã€‚'
        };

        let allServices = [];

        function showToast(msg) {
            const el = document.getElementById('toast');
            el.textContent = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 2000);
        }

        async function apiRequest(method, path, body) {
            const opts = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                }
            };
            if (body) opts.body = JSON.stringify(body);
            const resp = await fetch(BASE_URL + path, opts);
            return resp.json();
        }

        function showList() {
            document.getElementById('listPage').classList.remove('hidden');
            document.getElementById('detailPage').classList.add('hidden');
            window.scrollTo(0, 0);
        }

        function showDetail(serviceId) {
            const item = allServices.find(s => s.id === serviceId);
            if (!item) return;

            const detail = SERVICE_DETAILS[item.serviceCode] || DEFAULT_DETAIL;
            const isSubscribed = item.isSubscribed;

            let specsHtml = '';
            detail.specs.forEach(s => {
                specsHtml += `<div class="spec-item">
                    <div class="spec-label">${s.label}</div>
                    <div class="spec-value">${s.value}</div>
                </div>`;
            });

            let featuresHtml = '';
            detail.features.forEach(f => {
                featuresHtml += `<li>${f}</li>`;
            });

            const btnHtml = isSubscribed
                ? `<button class="btn-full btn-full-danger" id="detailBtn" onclick="detailToggle(${item.id})">å–æ¶ˆè®¢é˜…</button>`
                : `<button class="btn-full btn-full-primary" id="detailBtn" onclick="detailToggle(${item.id})">ç«‹å³è®¢é˜…</button>`;

            document.getElementById('detailContent').innerHTML = `
                <div class="detail-hero" style="background: ${detail.gradient}">
                    <img class="detail-hero-icon" src="${item.iconUrl || ''}"
                         onerror="this.style.background='rgba(255,255,255,0.3)'" alt="">
                    <h2>${item.name}</h2>
                    <div class="service-code">${item.serviceCode}</div>
                </div>
                <div class="detail-body">
                    <div class="detail-section">
                        <div class="detail-section-title"><span class="icon">ğŸ“‹</span> æœåŠ¡æ¦‚è¿°</div>
                        <p>${detail.overview}</p>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title"><span class="icon">ğŸ“Š</span> æœåŠ¡è§„æ ¼</div>
                        <div class="spec-grid">${specsHtml}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title"><span class="icon">âš¡</span> åŠŸèƒ½ç‰¹æ€§</div>
                        <ul class="feature-list">${featuresHtml}</ul>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title"><span class="icon">ğŸ¯</span> é€‚ç”¨åœºæ™¯</div>
                        <p>${detail.scenarios}</p>
                    </div>
                </div>
                <div class="detail-btn-area">${btnHtml}</div>
            `;

            document.getElementById('listPage').classList.add('hidden');
            document.getElementById('detailPage').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        async function detailToggle(serviceId) {
            const btn = document.getElementById('detailBtn');
            if (!btn || btn.disabled) return;

            const item = allServices.find(s => s.id === serviceId);
            if (!item) return;

            const isSubscribed = item.isSubscribed;
            const endpoint = isSubscribed ? '/api/v1/services/unsubscribe' : '/api/v1/services/subscribe';

            btn.disabled = true;
            try {
                const result = await apiRequest('POST', endpoint, { serviceId });
                if (result.code === 0) {
                    item.isSubscribed = !isSubscribed;
                    showToast(item.isSubscribed ? 'è®¢é˜…æˆåŠŸ' : 'å·²å–æ¶ˆè®¢é˜…');
                    // åˆ·æ–°è¯¦æƒ…é¡µæŒ‰é’®
                    showDetail(serviceId);
                    // åŒæ­¥åˆ·æ–°åˆ—è¡¨é¡µ
                    renderList();
                } else {
                    showToast(result.msg || 'æ“ä½œå¤±è´¥');
                }
            } catch (e) {
                showToast('ç½‘ç»œé”™è¯¯');
            } finally {
                btn.disabled = false;
            }
        }

        function renderList() {
            if (!allServices || allServices.length === 0) {
                document.getElementById('content').innerHTML = '<div class="loading">æš‚æ— å¯ç”¨æœåŠ¡</div>';
                return;
            }

            let html = '<div class="service-list">';
            allServices.forEach(item => {
                const badge = item.isSubscribed
                    ? '<span style="font-size:11px;color:#4F46E5;background:#EEF2FF;padding:2px 8px;border-radius:10px;margin-left:6px;">å·²è®¢é˜…</span>'
                    : '';
                html += `
                    <div class="service-card" onclick="showDetail(${item.id})">
                        <img class="service-icon" src="${item.iconUrl || ''}"
                             onerror="this.style.background='#e0e0e0'" alt="">
                        <div class="service-info">
                            <div class="service-name">${item.name}${badge}</div>
                            <div class="service-desc">${item.description || ''}</div>
                        </div>
                        <span class="arrow">â€º</span>
                    </div>`;
            });
            html += '</div>';
            document.getElementById('content').innerHTML = html;
        }

        async function loadServices() {
            const content = document.getElementById('content');
            if (!token) {
                content.innerHTML = '<div class="error">ç¼ºå°‘è®¤è¯ä¿¡æ¯ï¼Œè¯·ä» App å†…æ‰“å¼€</div>';
                return;
            }

            content.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            try {
                const result = await apiRequest('GET', '/api/v1/services/list');
                if (result.code !== 0) {
                    content.innerHTML = '<div class="error">åŠ è½½å¤±è´¥: ' + (result.msg || 'æœªçŸ¥é”™è¯¯') +
                        '<br><button onclick="loadServices()">é‡è¯•</button></div>';
                    return;
                }
                allServices = result.data.items || [];
                renderList();
            } catch (e) {
                content.innerHTML = '<div class="error">ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥<br>' +
                    '<button onclick="loadServices()">é‡è¯•</button></div>';
            }
        }

        loadServices();
    </script>
</body>
</html>
